#include "Wavelength.h"

namespace Wavelength
{

#pragma region XYZ
    // 1nm step - CIE-XYZ (2006).
    const double X[] = {
        0.003769647000, 0.004532416000, 0.005446553000, 0.006538868000, 0.007839699000, 0.009382967000, 0.011206080000,
        0.013349650000, 0.015856900000, 0.018772860000, 0.022143020000, 0.026012850000, 0.030430360000, 0.035443250000,
        0.041096400000, 0.047429860000, 0.054473940000, 0.062236120000, 0.070700480000, 0.079825130000, 0.089538030000,
        0.099748480000, 0.110401900000, 0.121456600000, 0.132874100000, 0.144621400000, 0.156646800000, 0.168790100000,
        0.180832800000, 0.192521600000, 0.203572900000, 0.213753100000, 0.223134800000, 0.231924500000, 0.240389200000,
        0.248852300000, 0.257589600000, 0.266499100000, 0.275353200000, 0.283892100000, 0.291824600000, 0.298920000000,
        0.305299300000, 0.311203100000, 0.316904700000, 0.322708700000, 0.328819400000, 0.334924200000, 0.340545200000,
        0.345168800000, 0.348255400000, 0.349415300000, 0.348907500000, 0.347174600000, 0.344670500000, 0.341848300000,
        0.339024000000, 0.335992600000, 0.332427600000, 0.328015700000, 0.322463700000, 0.315622500000, 0.307820100000,
        0.299477100000, 0.290977600000, 0.282664600000, 0.274796200000, 0.267431200000, 0.260584700000, 0.254274900000,
        0.248525400000, 0.243303900000, 0.238341400000, 0.233325300000, 0.227961900000, 0.221978100000, 0.215173500000,
        0.207561900000, 0.199218300000, 0.190229000000, 0.180690500000, 0.170715400000, 0.160447100000, 0.150024400000,
        0.139570500000, 0.129192000000, 0.118985900000, 0.109061500000, 0.099514240000, 0.090418500000, 0.081828950000,
        0.073768170000, 0.066194770000, 0.059063800000, 0.052342420000, 0.046008650000, 0.040061540000, 0.034543730000,
        0.029490910000, 0.024921400000, 0.020839810000, 0.017235910000, 0.014079240000, 0.011345160000, 0.009019658000,
        0.007097731000, 0.005571145000, 0.004394566000, 0.003516303000, 0.002887638000, 0.002461588000, 0.002206348000,
        0.002149559000, 0.002337091000, 0.002818931000, 0.003649178000, 0.004891359000, 0.006629364000, 0.008942902000,
        0.011902240000, 0.015569890000, 0.019976680000, 0.025046980000, 0.030675300000, 0.036749990000, 0.043151710000,
        0.049785840000, 0.056685540000, 0.063916510000, 0.071543520000, 0.079629170000, 0.088214730000, 0.097269780000,
        0.106750400000, 0.116619200000, 0.126846800000, 0.137406000000, 0.148247100000, 0.159307600000, 0.170518100000,
        0.181802600000, 0.193109000000, 0.204508500000, 0.216116600000, 0.228065000000, 0.240501500000, 0.253544100000,
        0.267130000000, 0.281135100000, 0.295416400000, 0.309811700000, 0.324167800000, 0.338431900000, 0.352578600000,
        0.366583900000, 0.380424400000, 0.394098800000, 0.407697200000, 0.421348400000, 0.435200300000, 0.449420600000,
        0.464161600000, 0.479439500000, 0.495218000000, 0.511439500000, 0.528023300000, 0.544869600000, 0.561889800000,
        0.579013700000, 0.596188200000, 0.613378400000, 0.630589700000, 0.647922300000, 0.665486600000, 0.683378200000,
        0.701677400000, 0.720411000000, 0.739449500000, 0.758628500000, 0.777788500000, 0.796775000000, 0.815453000000,
        0.833738900000, 0.851549300000, 0.868786200000, 0.885337600000, 0.901158800000, 0.916527800000, 0.931824500000,
        0.947452400000, 0.963838800000, 0.981259600000, 0.999295300000, 1.017343000000, 1.034790000000, 1.051011000000,
        1.065522000000, 1.078421000000, 1.089944000000, 1.100320000000, 1.109767000000, 1.118438000000, 1.126266000000,
        1.133138000000, 1.138952000000, 1.143620000000, 1.147095000000, 1.149464000000, 1.150838000000, 1.151326000000,
        1.151033000000, 1.150002000000, 1.148061000000, 1.144998000000, 1.140622000000, 1.134757000000, 1.127298000000,
        1.118342000000, 1.108033000000, 1.096515000000, 1.083928000000, 1.070387000000, 1.055934000000, 1.040592000000,
        1.024385000000, 1.007344000000, 0.989526800000, 0.971121300000, 0.952325700000, 0.933324800000, 0.914287700000,
        0.895279800000, 0.876015700000, 0.856160700000, 0.835423500000, 0.813556500000, 0.790456500000, 0.766436400000,
        0.741877700000, 0.717121900000, 0.692471700000, 0.668160000000, 0.644269700000, 0.620845000000, 0.597924300000,
        0.575541000000, 0.553729600000, 0.532541200000, 0.512021800000, 0.492207000000, 0.473122400000, 0.454741700000,
        0.436871900000, 0.419312100000, 0.401898000000, 0.384498600000, 0.367059200000, 0.349716700000, 0.332630500000,
        0.315934100000, 0.299737400000, 0.284118900000, 0.269105300000, 0.254707700000, 0.240931900000, 0.227779200000,
        0.215243100000, 0.203301000000, 0.191927600000, 0.181098700000, 0.170791400000, 0.160984200000, 0.151657700000,
        0.142793600000, 0.134373700000, 0.126380800000, 0.118797900000, 0.111608800000, 0.104797500000, 0.098348350000,
        0.092245970000, 0.086475060000, 0.081019860000, 0.075865140000, 0.070996330000, 0.066399600000, 0.062062250000,
        0.057974090000, 0.054125330000, 0.050506000000, 0.047106060000, 0.043914110000, 0.040914110000, 0.038090670000,
        0.035430340000, 0.032921380000, 0.030556720000, 0.028341460000, 0.026280330000, 0.024374650000, 0.022623060000,
        0.021019350000, 0.019546470000, 0.018187270000, 0.016927270000, 0.015754170000, 0.014658540000, 0.013635710000,
        0.012682050000, 0.011793940000, 0.010967780000, 0.010199640000, 0.009484317000, 0.008816851000, 0.008192921000,
        0.007608750000, 0.007061391000, 0.006549509000, 0.006071970000, 0.005627476000, 0.005214608000, 0.004831848000,
        0.004477579000, 0.004150166000, 0.003847988000, 0.003569452000, 0.003312857000, 0.003076022000, 0.002856894000,
        0.002653681000, 0.002464821000, 0.002289060000, 0.002125694000, 0.001974121000, 0.001833723000, 0.001703876000,
        0.001583904000, 0.001472939000, 0.001370151000, 0.001274803000, 0.001186238000, 0.001103871000, 0.001027194000,
        0.000955749300, 0.000889126200, 0.000826953500, 0.000768935100, 0.000714942500, 0.000664859000, 0.000618542100,
        0.000575830300, 0.000536504600, 0.000500184200, 0.000466500500, 0.000435138600, 0.000405830300, 0.000378373300,
        0.000352689200, 0.000328719900, 0.000306399800, 0.000285657700, 0.000266410800, 0.000248546200, 0.000231952900,
        0.000216530000, 0.000202185300, 0.000188833800, 0.000176393500, 0.000164789500, 0.000153954200, 0.000143827000,
        0.000134357200, 0.000125514100, 0.000117270600, 0.000109598300, 0.000102468500, 0.000095847150, 0.000089683160,
        0.000083927340, 0.000078537080, 0.000073475510, 0.000068715760, 0.000064252570, 0.000060082920, 0.000056200980,
        0.000052598700, 0.000049262790, 0.000046166230, 0.000043282120, 0.000040587150, 0.00003806114
    };
    const double Y[] = {
        0.000414616100, 0.000502833300, 0.000608499100, 0.000734443600, 0.000883738900, 0.001059646000, 0.001265532000,
        0.001504753000, 0.001780493000, 0.002095572000, 0.002452194000, 0.002852216000, 0.003299115000, 0.003797466000,
        0.004352768000, 0.004971717000, 0.005661014000, 0.006421615000, 0.007250312000, 0.008140173000, 0.009079860000,
        0.010056080000, 0.011064560000, 0.012105220000, 0.013180140000, 0.014293770000, 0.015450040000, 0.016640930000,
        0.017853020000, 0.019070180000, 0.020273690000, 0.021448050000, 0.022600410000, 0.023747890000, 0.024912470000,
        0.026121060000, 0.027399230000, 0.028749930000, 0.030169090000, 0.031651450000, 0.033190380000, 0.034779120000,
        0.036414950000, 0.038095690000, 0.039818430000, 0.041579400000, 0.043370980000, 0.045171800000, 0.046954200000,
        0.048687180000, 0.050336570000, 0.051876110000, 0.053322180000, 0.054706030000, 0.056063350000, 0.057433930000,
        0.058851070000, 0.060308090000, 0.061786440000, 0.063265700000, 0.064723520000, 0.066147490000, 0.067572560000,
        0.069049280000, 0.070632800000, 0.072383390000, 0.074359600000, 0.076593830000, 0.079114360000, 0.081953450000,
        0.085148160000, 0.088726570000, 0.092660080000, 0.096897230000, 0.101374600000, 0.106014500000, 0.110737700000,
        0.115511100000, 0.120312200000, 0.125116100000, 0.129895700000, 0.134629900000, 0.139330900000, 0.144023500000,
        0.148737200000, 0.153506600000, 0.158364400000, 0.163319900000, 0.168376100000, 0.173536500000, 0.178804800000,
        0.184181900000, 0.189655900000, 0.195210100000, 0.200825900000, 0.206482800000, 0.212182600000, 0.218027900000,
        0.224158600000, 0.230730200000, 0.237916000000, 0.245870600000, 0.254602300000, 0.264076000000, 0.274249000000,
        0.285068000000, 0.296483700000, 0.308501000000, 0.321139300000, 0.334417500000, 0.348353600000, 0.362960100000,
        0.378227500000, 0.394135900000, 0.410658200000, 0.427759500000, 0.445399300000, 0.463539600000, 0.482137600000,
        0.501143000000, 0.520497200000, 0.540138700000, 0.560020800000, 0.580097200000, 0.600317200000, 0.620625600000,
        0.640939800000, 0.661077200000, 0.680813400000, 0.699904400000, 0.718089000000, 0.735159300000, 0.751182100000,
        0.766314300000, 0.780735200000, 0.794644800000, 0.808207400000, 0.821381700000, 0.834070100000, 0.846171100000,
        0.857579900000, 0.868240800000, 0.878306100000, 0.887990700000, 0.897521100000, 0.907134700000, 0.916994700000,
        0.926929500000, 0.936673100000, 0.945948200000, 0.954467500000, 0.961983400000, 0.968439000000, 0.973828900000,
        0.978151900000, 0.981410600000, 0.983666900000, 0.985208100000, 0.986381300000, 0.987535700000, 0.989022800000,
        0.991081100000, 0.993491300000, 0.995917200000, 0.998020500000, 0.999460800000, 0.999993000000, 0.999755700000,
        0.998983900000, 0.997912300000, 0.996773700000, 0.995735600000, 0.994711500000, 0.993553400000, 0.992115600000,
        0.990254900000, 0.987859600000, 0.984932400000, 0.981503600000, 0.977603500000, 0.973261100000, 0.968476400000,
        0.963136900000, 0.957106200000, 0.950254000000, 0.942456900000, 0.933689700000, 0.924289300000, 0.914670700000,
        0.905233300000, 0.896361300000, 0.888306900000, 0.880846200000, 0.873644500000, 0.866375500000, 0.858720300000,
        0.850429500000, 0.841504700000, 0.832010900000, 0.822015400000, 0.811586800000, 0.800787400000, 0.789651500000,
        0.778205300000, 0.766473300000, 0.754478500000, 0.742247300000, 0.729822900000, 0.717252500000, 0.704581800000,
        0.691855300000, 0.679100900000, 0.666284600000, 0.653359500000, 0.640280700000, 0.627006600000, 0.613514800000,
        0.599849400000, 0.586068200000, 0.572226100000, 0.558374600000, 0.544553500000, 0.530767300000, 0.517013000000,
        0.503288900000, 0.489595000000, 0.475944200000, 0.462395800000, 0.449015400000, 0.435862200000, 0.422989700000,
        0.410415200000, 0.398035600000, 0.385730000000, 0.373390700000, 0.360924500000, 0.348286000000, 0.335570200000,
        0.322896300000, 0.310370400000, 0.298086500000, 0.286116000000, 0.274482200000, 0.263195300000, 0.252262800000,
        0.241690200000, 0.231480900000, 0.221637800000, 0.212162200000, 0.203054200000, 0.194312400000, 0.185922700000,
        0.177827400000, 0.169965400000, 0.162284100000, 0.154739700000, 0.147308100000, 0.140016900000, 0.132901300000,
        0.125991300000, 0.119312000000, 0.112882000000, 0.106711300000, 0.100805200000, 0.095166530000, 0.089795940000,
        0.084690440000, 0.079840090000, 0.075233720000, 0.070860610000, 0.066710450000, 0.062773600000, 0.059041790000,
        0.055507030000, 0.052161390000, 0.048996990000, 0.046005780000, 0.043178850000, 0.040507550000, 0.037983760000,
        0.035599820000, 0.033348560000, 0.031223320000, 0.029217800000, 0.027326010000, 0.025542230000, 0.023861210000,
        0.022278590000, 0.020790200000, 0.019391850000, 0.018079390000, 0.016848170000, 0.015691880000, 0.014604460000,
        0.013580620000, 0.012615730000, 0.011706960000, 0.010856080000, 0.010064760000, 0.009333376000, 0.008661284000,
        0.008046048000, 0.007481130000, 0.006959987000, 0.006477070000, 0.006027677000, 0.005608169000, 0.005216691000,
        0.004851785000, 0.004512008000, 0.004195941000, 0.003902057000, 0.003628371000, 0.003373005000, 0.003134315000,
        0.002910864000, 0.002701528000, 0.002505796000, 0.002323231000, 0.002153333000, 0.001995557000, 0.001849316000,
        0.001713976000, 0.001588899000, 0.001473453000, 0.001367022000, 0.001268954000, 0.001178421000, 0.001094644000,
        0.001016943000, 0.000944726900, 0.000877517100, 0.000815043800, 0.000757075500, 0.000703375500, 0.000653705000,
        0.000607804800, 0.000565343500, 0.000526004600, 0.000489506100, 0.000455597000, 0.000424054800, 0.000394686000,
        0.000367317800, 0.000341794100, 0.000317973800, 0.000295744100, 0.000275055800, 0.000255864000, 0.000238114200,
        0.000221744500, 0.000206671100, 0.000192747400, 0.000179831500, 0.000167802300, 0.000156556600, 0.000146016800,
        0.000136153500, 0.000126945100, 0.000118367100, 0.000110392800, 0.000102990800, 0.000096118360, 0.000089733230,
        0.000083796940, 0.000078274420, 0.000073133120, 0.000068341420, 0.000063870350, 0.000059693890, 0.000055788620,
        0.000052135090, 0.000048721790, 0.000045538450, 0.000042574430, 0.000039818840, 0.000037258770, 0.000034874670,
        0.000032647650, 0.000030561400, 0.000028601750, 0.000026758410, 0.000025029430, 0.000023413730, 0.000021909140,
        0.000020512590, 0.000019219020, 0.000018017960, 0.000016898990, 0.000015853090, 0.00001487243
    };
    const double Z[] = {
        0.018472600000, 0.022211010000, 0.026698190000, 0.032069370000, 0.038478320000, 0.046097840000, 0.055119530000,
        0.065752570000, 0.078221130000, 0.092760130000, 0.109609000000, 0.129007700000, 0.151204700000, 0.176444100000,
        0.204951700000, 0.236924600000, 0.272512300000, 0.311782000000, 0.354706400000, 0.401147300000, 0.450836900000,
        0.503416400000, 0.558636100000, 0.616273400000, 0.676098200000, 0.737882200000, 0.801301900000, 0.865557300000,
        0.929579100000, 0.992129300000, 1.051821000000, 1.107509000000, 1.159527000000, 1.208869000000, 1.256834000000,
        1.305008000000, 1.354758000000, 1.405594000000, 1.456414000000, 1.505960000000, 1.552826000000, 1.595902000000,
        1.635768000000, 1.673573000000, 1.710604000000, 1.748280000000, 1.787504000000, 1.826609000000, 1.863108000000,
        1.894332000000, 1.917479000000, 1.930529000000, 1.934819000000, 1.932650000000, 1.926395000000, 1.918437000000,
        1.910430000000, 1.901224000000, 1.889000000000, 1.871996000000, 1.848545000000, 1.817792000000, 1.781627000000,
        1.742514000000, 1.702749000000, 1.664439000000, 1.629207000000, 1.597360000000, 1.568896000000, 1.543823000000,
        1.522157000000, 1.503611000000, 1.486673000000, 1.469595000000, 1.450709000000, 1.428440000000, 1.401587000000,
        1.370094000000, 1.334220000000, 1.294275000000, 1.250610000000, 1.203696000000, 1.154316000000, 1.103284000000,
        1.051347000000, 0.999178900000, 0.947395800000, 0.896622200000, 0.847398100000, 0.800157600000, 0.755237900000,
        0.712787900000, 0.672519800000, 0.634097600000, 0.597243300000, 0.561731300000, 0.527492100000, 0.494880900000,
        0.464258600000, 0.435884100000, 0.409931300000, 0.386426100000, 0.365056600000, 0.345481200000, 0.327409500000,
        0.310593900000, 0.294810200000, 0.279819400000, 0.265410000000, 0.251408400000, 0.237675300000, 0.224121100000,
        0.210748400000, 0.197583900000, 0.184657400000, 0.172001800000, 0.159691800000, 0.147941500000, 0.136942800000,
        0.126827900000, 0.117679600000, 0.109497000000, 0.102094300000, 0.095279930000, 0.088900750000, 0.082835480000,
        0.077009820000, 0.071440010000, 0.066154360000, 0.061171990000, 0.056504070000, 0.052151210000, 0.048095660000,
        0.044317200000, 0.040797340000, 0.037519120000, 0.034468460000, 0.031637640000, 0.029019010000, 0.026603640000,
        0.024381640000, 0.022340970000, 0.020464150000, 0.018734560000, 0.017137880000, 0.015661740000, 0.014296440000,
        0.013037020000, 0.011878970000, 0.010817250000, 0.009846470000, 0.008960687000, 0.008152811000, 0.007416025000,
        0.006744115000, 0.006131421000, 0.005572778000, 0.005063463000, 0.004599169000, 0.004175971000, 0.003790291000,
        0.003438952000, 0.003119341000, 0.002829038000, 0.002565722000, 0.002327186000, 0.002111280000, 0.001915766000,
        0.001738589000, 0.001577920000, 0.001432128000, 0.001299781000, 0.001179667000, 0.001070694000, 0.000971862300,
        0.000882253100, 0.000801023100, 0.000727388400, 0.000660634700, 0.000600114600, 0.000545241600, 0.000495484700,
        0.000450364200, 0.000409445500, 0.000372334500, 0.000338673900, 0.000308139600, 0.000280437000, 0.000255299600,
        0.000232485900, 0.000211777200, 0.000192975800, 0.000175902400, 0.000160394700, 0.000146305900, 0.000133503100,
        0.000121866000, 0.000111285700, 0.000101663400, 0.000092910030, 0.000084944680, 0.000077694250, 0.000071092470,
        0.000065079360, 0.000059600610, 0.000054607060, 0.000050054170, 0.000045901570, 0.000042112680, 0.000038654370,
        0.000035496610, 0.000032612200, 0.000029976430, 0.000027566930, 0.000025363390, 0.000023347380, 0.000021502210,
        0.000019812680, 0.000018265000, 0.000016846670, 0.000015546310, 0.000014353600, 0.000013259150, 0.000012254430,
        0.000011331690, 0.000010483870, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000,
        0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.000000000000, 0.00000000000
    };
#pragma endregion

    double interpolate(const double* values, int index, double offset);

    void getRGB(double len, double& outR, double& outG, double& outB)
    {
        if (len < LEN_MIN || len > LEN_MAX)
        {
            outR = 0;
            outG = 0;
            outB = 0;
        }

        len -= LEN_MIN;
        int index = (int)floor(len / LEN_STEP);
        double offset = len - (LEN_STEP * (double)index);

        double x = interpolate(X, index, offset);
        double y = interpolate(Y, index, offset);
        double z = interpolate(Z, index, offset);

        //ColorSystems::Rec709.XYZtoRGB(x, y, z, outR, outG, outB);

        outR = x;
        outG = y;
        outB = z;
    }

    double interpolate(const double* values, int index, double offset)
    {
        if (offset == 0)
            return values[index];

        double x0 = (double)index * LEN_STEP;
        double x1 = x0 + LEN_STEP;
        double y0 = values[index];
        double y1 = values[1 + index];

        return y0 + offset * (y1 - y0) / (x1 - x0);
    }

}